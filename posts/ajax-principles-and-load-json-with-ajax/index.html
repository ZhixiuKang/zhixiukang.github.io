<!DOCTYPE html>
<html lang="zh-cn">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet"
    href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.3/styles/atom-one-dark.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.3/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <meta name="author" content="修">
    <meta name="description" content="修的个人主页">
    <meta name="keywords" content="Zhixiu Kang, 康知修, 修,笔记">

    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="AJAX的原理和加载JSON"/>
<meta name="twitter:description" content="AJAX(Async JavaScript And XML) → 用 JS 发请求和收响应
 让我们通过使用 AJAX 来加载 CSS、JavaScript、HTML、XML 和 JSON，学会 AJAX 的原理和用法。
 示例代码
 背景 AJAX 是浏览器上的功能  浏览器可以发请求，收响应 浏览器在 window 上加了一个XMLHttpRequest函数 用这个构造函数(类)可以构造出一个对象 JS 通过它实现发请求，收响应  小工具:node-dev
   准备一个服务器  使用server.js作为我们的服务器 用node server.js 8888启动 添加index.html/main.js两个路由:  if (path === &#34;/index.html&#34;) { response.statusCode = 200; response.setHeader(&#34;Content-Type&#34;, &#34;text/html;charset=utf-8&#34;); response.write(`&lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt;&lt;title&gt;ajax&lt;/title&gt;&lt;/head&gt; &lt;body&gt;&lt;h1&gt;AJAX demo&lt;/h1&gt; &lt;script src=&#34;/main.js&#34;&gt;&lt;/script&gt; &lt;/body&gt; &lt;/html&gt; `); response.end(); } else if (path === &#34;/main."/>

    <meta property="og:title" content="AJAX的原理和加载JSON" />
<meta property="og:description" content="AJAX(Async JavaScript And XML) → 用 JS 发请求和收响应
 让我们通过使用 AJAX 来加载 CSS、JavaScript、HTML、XML 和 JSON，学会 AJAX 的原理和用法。
 示例代码
 背景 AJAX 是浏览器上的功能  浏览器可以发请求，收响应 浏览器在 window 上加了一个XMLHttpRequest函数 用这个构造函数(类)可以构造出一个对象 JS 通过它实现发请求，收响应  小工具:node-dev
   准备一个服务器  使用server.js作为我们的服务器 用node server.js 8888启动 添加index.html/main.js两个路由:  if (path === &#34;/index.html&#34;) { response.statusCode = 200; response.setHeader(&#34;Content-Type&#34;, &#34;text/html;charset=utf-8&#34;); response.write(`&lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt;&lt;title&gt;ajax&lt;/title&gt;&lt;/head&gt; &lt;body&gt;&lt;h1&gt;AJAX demo&lt;/h1&gt; &lt;script src=&#34;/main.js&#34;&gt;&lt;/script&gt; &lt;/body&gt; &lt;/html&gt; `); response.end(); } else if (path === &#34;/main." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://zhixiukang.com/posts/ajax-principles-and-load-json-with-ajax/" />
<meta property="article:published_time" content="2020-03-11T15:21:33-08:00" />
<meta property="article:modified_time" content="2020-03-11T15:21:33-08:00" />


    
      <base href="http://zhixiukang.com/posts/ajax-principles-and-load-json-with-ajax/">
    
    <title>
AJAX的原理和加载JSON · 修的个人网站
</title>

    
      <link rel="canonical" href="http://zhixiukang.com/posts/ajax-principles-and-load-json-with-ajax/">
    

    <link href="https://fonts.googleapis.com/css?family=Lato:400,700%7CMerriweather:300,700%7CSource+Code+Pro:400,700" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.11.2/css/all.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css" integrity="sha256-l85OmPOjvil/SOvVt3HnSSjzF1TUMyT9eV0c2BzEGzU=" crossorigin="anonymous" />


    
      
      
      <link rel="stylesheet" href="http://zhixiukang.com/css/coder.min.18c2bf5643e5b1a3c68d9cef0bdbeadb7fb3d6fa17b13615c3d6ee6bcc6c9d35.css" integrity="sha256-GMK/VkPlsaPGjZzvC9vq23&#43;z1voXsTYVw9bua8xsnTU=" crossorigin="anonymous" media="screen" />
    

    

    

    

    
    
    <link rel="icon" type="image/png" href="http://zhixiukang.com/img/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="http://zhixiukang.com/img/favicon-16x16.png" sizes="16x16">

    <meta name="generator" content="Hugo 0.62.1" />
  </head>

  
  
  <body class="colorscheme-light">
    <main class="wrapper">
      <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="http://zhixiukang.com/">
      修的个人网站
    </a>
    <input type="checkbox" id="menu-toggle" />
    <label class="menu-button float-right" for="menu-toggle"><i class="fas fa-bars"></i></label>
    <ul class="navigation-list">
      
        
          <li class="navigation-item">
            <a class="navigation-link" href="http://zhixiukang.com/posts/">技术文章</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="http://zhixiukang.com/explore/">兴趣学习</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="http://zhixiukang.com/bucket-list/">Bucket List</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="http://zhixiukang.com/tags/">分类</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="http://zhixiukang.com/about/">联系我</a>
          </li>
        
      
      
    </ul>
  </section>
</nav>


      <div class="content">
        
<section class="container post">
  <article>
    <header>
      <div class="post-title">
        <h1 class="title">AJAX的原理和加载JSON</h1>
      </div>
      <div class="post-meta">
        <div class="date">
          <span class="posted-on">
            <i class="fas fa-calendar"></i>
            <time datetime='2020-03-11T15:21:33-08:00'>
              March 11, 2020
            </time>
          </span>
          
        </div>
        <div class="categories">
  <i class="fas fa-folder"></i>
    <a href="http://zhixiukang.com/categories/tech/">Tech</a></div>

        <div class="tags">
  <i class="fas fa-tag"></i>
    <a href="http://zhixiukang.com/tags/%E5%89%8D%E5%90%8E%E5%88%86%E7%A6%BB/">前后分离</a></div>

      </div>
    </header>

    <div>
      <blockquote>
<p>AJAX(Async JavaScript And XML) → 用 JS 发请求和收响应</p>
</blockquote>
<p>让我们通过使用 AJAX 来加载 CSS、JavaScript、HTML、XML 和 JSON，学会 AJAX 的原理和用法。</p>
<blockquote>
<p><a href="https://github.com/ZhixiuKang/ajax-1">示例代码</a></p>
</blockquote>
<h1 id="heading">背景</h1>
<h2 id="ajax-">AJAX 是浏览器上的功能</h2>
<ul>
<li>浏览器可以发请求，收响应</li>
<li>浏览器在 window 上加了一个<code>XMLHttpRequest</code>函数</li>
<li>用这个构造函数(类)可以构造出一个对象</li>
<li>JS 通过它实现发请求，收响应
<blockquote>
<p><a href="https://github.com/fgnass/node-dev#readme">小工具:node-dev</a></p>
</blockquote>
</li>
</ul>
<h2 id="heading-1">准备一个服务器</h2>
<ul>
<li>使用<a href="https://github.com/ZhixiuKang/node-demo-1/blob/master/server.js">server.js</a>作为我们的服务器</li>
<li>用<code>node server.js 8888</code>启动</li>
<li>添加<code>index.html</code>/<code>main.js</code>两个路由:</li>
</ul>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript"><span style="color:#fff;font-weight:bold">if</span> (path === <span style="color:#0ff;font-weight:bold">&#34;/index.html&#34;</span>) {
  response.statusCode = <span style="color:#ff0;font-weight:bold">200</span>;
  response.setHeader(<span style="color:#0ff;font-weight:bold">&#34;Content-Type&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;text/html;charset=utf-8&#34;</span>);
  response.write(<span style="color:#0ff;font-weight:bold">`</span><span style="color:#0ff;font-weight:bold">
</span><span style="color:#0ff;font-weight:bold">    &lt;!DOCTYPE html&gt;
</span><span style="color:#0ff;font-weight:bold">    &lt;html&gt;
</span><span style="color:#0ff;font-weight:bold">    &lt;head&gt;&lt;title&gt;ajax&lt;/title&gt;&lt;/head&gt;
</span><span style="color:#0ff;font-weight:bold">    &lt;body&gt;&lt;h1&gt;AJAX demo&lt;/h1&gt;
</span><span style="color:#0ff;font-weight:bold">        &lt;script src=&#34;/main.js&#34;&gt;&lt;/script&gt;
</span><span style="color:#0ff;font-weight:bold">    &lt;/body&gt;
</span><span style="color:#0ff;font-weight:bold">    &lt;/html&gt;
</span><span style="color:#0ff;font-weight:bold">    </span><span style="color:#0ff;font-weight:bold">`</span>);
  response.end();
} <span style="color:#fff;font-weight:bold">else</span> <span style="color:#fff;font-weight:bold">if</span> (path === <span style="color:#0ff;font-weight:bold">&#34;/main.js&#34;</span>) {
  response.statusCode = <span style="color:#ff0;font-weight:bold">200</span>;
  response.setHeader(<span style="color:#0ff;font-weight:bold">&#34;Content-Type&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;text/css;charset=utf-8&#34;</span>);
  response.write(<span style="color:#0ff;font-weight:bold">`</span><span style="color:#0ff;font-weight:bold">console.log(&#34;I am main.js&#34;)</span><span style="color:#0ff;font-weight:bold">`</span>);
  response.end();
}
</code></pre></div><h1 id="-1--css">挑战 1-加载 CSS</h1>
<ul>
<li>以前我们用<code>&lt;link rel=stylesheet href=&quot;1.css&quot;/&gt;</code></li>
<li>今天请用 AJAX 加载 CSS</li>
</ul>
<h2 id="heading-2">四个步骤</h2>
<ol>
<li>创建<code>HttpRequest</code>对象(<code>XMLHttpRequest</code>)</li>
<li>调用对象的<code>open</code>方法</li>
<li>监听对象的<code>onload</code>&amp;<code>onerror</code>事件
<blockquote>
<p>专业前端会改用<code>onreadystatechange</code>事件, 具体用法可以参考: <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest/onreadystatechange">XMLHttpRequest.onreadystatechange| MDN</a></p>
<p>扩展阅读: <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest/readyState">ready state | MDN</a></p>
</blockquote>
</li>
</ol>
<blockquote>
<p>在事件处理函数里操作 CSS 文件内容</p>
</blockquote>
<ol start="4">
<li>调用对象的<code>send</code>方法(发送请求)
<blockquote>
<p>具体可以看: <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest/send">XMLHttpRequest.send() | MDN</a></p>
</blockquote>
</li>
</ol>
<p>HTML:</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html"><span style="color:#0f0;font-weight:bold">&lt;!DOCTYPE html&gt;</span>
&lt;<span style="font-weight:bold">html</span>&gt;
  &lt;<span style="font-weight:bold">head</span>&gt;
    &lt;<span style="font-weight:bold">title</span>&gt;ajax&lt;/<span style="font-weight:bold">title</span>&gt;
    <span style="color:#0f0;font-weight:bold">&lt;!— &lt;link rel=&#34;stylesheet&#34; href=&#34;/style.css&#34; /&gt;</span>
    —&gt;
  &lt;/<span style="font-weight:bold">head</span>&gt;
  &lt;<span style="font-weight:bold">body</span>&gt;
    &lt;<span style="font-weight:bold">h1</span>&gt;AJAX demo 1&lt;/<span style="font-weight:bold">h1</span>&gt;
    &lt;<span style="font-weight:bold">p</span>&gt;
      &lt;<span style="font-weight:bold">button</span> <span style="color:#007f7f">id</span>=<span style="color:#0ff;font-weight:bold">&#34;getCSS&#34;</span>&gt;request css&lt;/<span style="font-weight:bold">button</span>&gt;
    &lt;/<span style="font-weight:bold">p</span>&gt;
    &lt;<span style="font-weight:bold">script</span> <span style="color:#007f7f">src</span>=<span style="color:#0ff;font-weight:bold">&#34;/main.js&#34;</span>&gt;&lt;/<span style="font-weight:bold">script</span>&gt;
  &lt;/<span style="font-weight:bold">body</span>&gt;
&lt;/<span style="font-weight:bold">html</span>&gt;
</code></pre></div><p>JavaScript:</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">console.log(<span style="color:#0ff;font-weight:bold">&#34;我是main.js&#34;</span>);

getCSS.onclick = () =&gt; {
  <span style="color:#fff;font-weight:bold">const</span> request = <span style="color:#fff;font-weight:bold">new</span> XMLHttpRequest();
  request.open(<span style="color:#0ff;font-weight:bold">&#34;GET&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;/style.css&#34;</span>);
  request.onload = () =&gt; {
    console.log(<span style="color:#0ff;font-weight:bold">&#34;request.response&#34;</span>);
    console.log(request.response);
    console.log(<span style="color:#0ff;font-weight:bold">&#34;成功啦&#34;</span>);
    <span style="color:#007f7f">// 创建style标签
</span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">const</span> style = <span style="color:#fff;font-weight:bold">document</span>.createElement(<span style="color:#0ff;font-weight:bold">&#34;style&#34;</span>);
    <span style="color:#007f7f">// 填写style内容
</span><span style="color:#007f7f"></span>    style.innerHTML = request.response;
    <span style="color:#007f7f">// 插到头里面
</span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">document</span>.head.appendChild(style);
  };
  request.onerror = () =&gt; {
    console.log(<span style="color:#0ff;font-weight:bold">&#34;失败了...&#34;</span>);
  };
  request.send();
};
</code></pre></div><h1 id="-2--js">挑战 2-加载 JS</h1>
<ul>
<li>以前我们用<code>&lt;script src=&quot;2.js&quot;&gt;&lt;/script&gt;</code></li>
<li>今天请用 AJAX 加载 JS</li>
</ul>
<h2 id="heading-3">四个步骤</h2>
<ol>
<li>创建<code>HttpRequest</code>对象(<code>XMLHttpRequest</code>)</li>
<li>调用对象的<code>open</code>方法</li>
<li>监听对象的<code>onreadystatechange</code>事件
<blockquote>
<p>在事件处理函数里操作 JS 文件内容</p>
</blockquote>
</li>
<li>调用对象的<code>send</code>方法(发送请求)</li>
</ol>
<p>JavaScript:</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">console.log(<span style="color:#0ff;font-weight:bold">&#34;I am main.js&#34;</span>);
getJS.onclick = () =&gt; {
  <span style="color:#fff;font-weight:bold">const</span> request = <span style="color:#fff;font-weight:bold">new</span> XMLHttpRequest();
  request.open(<span style="color:#0ff;font-weight:bold">&#34;GET&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;/2.js&#34;</span>);
  request.onload = () =&gt; {
    console.log(request.response);
    <span style="color:#fff;font-weight:bold">const</span> script = <span style="color:#fff;font-weight:bold">document</span>.createElement(<span style="color:#0ff;font-weight:bold">&#34;script&#34;</span>);
    script.innerHTML = request.response;
    <span style="color:#fff;font-weight:bold">document</span>.body.appendChild(script);
  };
  request.onerror = () =&gt; {};
  request.send();
};
</code></pre></div><h1 id="-3--html">挑战 3-加载 HTML</h1>
<ul>
<li>以前我们不会加载<code>3.html</code></li>
</ul>
<h2 id="heading-4">四个步骤</h2>
<ol>
<li>创建<code>HttpRequest</code>对象(<code>XMLHttpRequest</code>)</li>
<li>调用对象的<code>open</code>方法</li>
<li>监听对象的<code>onreadystatechange</code>事件
<blockquote>
<p>在事件处理函数里操作 HTML 文件内容</p>
</blockquote>
</li>
<li>调用对象的<code>send</code>方法(发送请求)</li>
</ol>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">console.log(<span style="color:#0ff;font-weight:bold">&#34;I am main.js&#34;</span>);
getHTML.onclick = () =&gt; {
  <span style="color:#fff;font-weight:bold">const</span> request = <span style="color:#fff;font-weight:bold">new</span> XMLHttpRequest();
  request.open(<span style="color:#0ff;font-weight:bold">&#34;GET&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;/3.html&#34;</span>);
  request.onload = () =&gt; {
    console.log(request.response);
    <span style="color:#fff;font-weight:bold">const</span> div = <span style="color:#fff;font-weight:bold">document</span>.createElement(<span style="color:#0ff;font-weight:bold">&#34;div&#34;</span>);
    div.innerHTML = request.response;
    <span style="color:#fff;font-weight:bold">document</span>.body.appendChild(div);
  };
  request.onerror = () =&gt; {};
  request.send();
};
</code></pre></div><h1 id="onreadystatechange-">onreadystatechange 事件</h1>
<blockquote>
<p>使用原因: <code>onerror()</code>并没有很好的匹配 AJAX</p>
</blockquote>
<ul>
<li>用<code>onreadystatechange</code>重做一下挑战 1</li>
</ul>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">getCSS.onclick = () =&gt; {
  <span style="color:#fff;font-weight:bold">const</span> request = <span style="color:#fff;font-weight:bold">new</span> XMLHttpRequest();
  request.open(<span style="color:#0ff;font-weight:bold">&#34;GET&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;/style.css&#34;</span>);
  request.onreadystatechange = () =&gt; {
    <span style="color:#007f7f">// console.log(request.readyState);
</span><span style="color:#007f7f"></span>    <span style="color:#fff;font-weight:bold">if</span> (request.readyState === <span style="color:#ff0;font-weight:bold">4</span>) {
      <span style="color:#007f7f">// 下载完成，但不知道是成功 2xx 还是失败 4xx 5xx
</span><span style="color:#007f7f"></span>      <span style="color:#fff;font-weight:bold">if</span> (request.status &gt;= <span style="color:#ff0;font-weight:bold">200</span> &amp;&amp; request.status &lt; <span style="color:#ff0;font-weight:bold">300</span>) {
        <span style="color:#fff;font-weight:bold">const</span> style = <span style="color:#fff;font-weight:bold">document</span>.createElement(<span style="color:#0ff;font-weight:bold">&#34;style&#34;</span>);
        style.innerHTML = request.response;
        <span style="color:#fff;font-weight:bold">document</span>.head.appendChild(style);
      } <span style="color:#fff;font-weight:bold">else</span> {
        alert(<span style="color:#0ff;font-weight:bold">&#34;加载css失败&#34;</span>);
      }
    }
  };
  request.send();
};
</code></pre></div><h1 id="-4--xml">挑战 4-加载 XML</h1>
<ul>
<li>以前我们不会加载<code>4.html</code></li>
</ul>
<h2 id="heading-5">四个步骤</h2>
<ol>
<li>创建<code>HttpRequest</code>对象(<code>XMLHttpRequest</code>)</li>
<li>调用对象的<code>open</code>方法</li>
<li>监听对象的<code>onreadystatechange</code>事件
<blockquote>
<p>在事件处理函数里操作<code>responseXML</code></p>
</blockquote>
</li>
<li>调用对象的<code>send</code>方法(发送请求)</li>
</ol>
<p>XML:</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#0f0;font-weight:bold">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
<span style="font-weight:bold">&lt;message</span><span style="font-weight:bold">&gt;</span>
    <span style="font-weight:bold">&lt;warning</span><span style="font-weight:bold">&gt;</span>
         Hello World
    <span style="font-weight:bold">&lt;/warning&gt;</span>
<span style="font-weight:bold">&lt;/message&gt;</span>
</code></pre></div><p>JavaScript:</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">getXML.onclick = () =&gt; {
  <span style="color:#fff;font-weight:bold">const</span> request = <span style="color:#fff;font-weight:bold">new</span> XMLHttpRequest();
  request.open(<span style="color:#0ff;font-weight:bold">&#34;GET&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;/4.xml&#34;</span>);
  request.onreadystatechange = () =&gt; {
    <span style="color:#fff;font-weight:bold">if</span> ((request.readyState === <span style="color:#ff0;font-weight:bold">4</span>) &amp; (request.status === <span style="color:#ff0;font-weight:bold">200</span>)) {
      <span style="color:#fff;font-weight:bold">const</span> dom = request.responseXML;
      <span style="color:#fff;font-weight:bold">const</span> text = dom.getElementsByTagName(<span style="color:#0ff;font-weight:bold">&#34;warning&#34;</span>)[<span style="color:#ff0;font-weight:bold">0</span>].textContent;
      console.log(text.trim());
    }
  };
  request.send();
};
</code></pre></div><h1 id="heading-6">总结</h1>
<h2 id="http-">HTTP 是个框，什么都能往里装</h2>
<ul>
<li>可以装 HTML、CSS、JS、XML&hellip;</li>
<li>记得设置正确的<code>Content-Type</code>，这是好习惯</li>
<li>只要你知道怎么解析这些内容，就可以使用这些内容</li>
</ul>
<h2 id="heading-7">解析方法</h2>
<ul>
<li>得到 CSS 之后生成 style 标签</li>
<li>得到 JS 之后生成 script 标签</li>
<li>得到 HTML 之后使用 innerHTML 和 DOM API</li>
<li>得到 XML 之后使用 responseXML 和 DOM API</li>
<li>不同类型的数据有不同类型的解析办法</li>
</ul>
<h1 id="-5--json">挑战 5-加载 JSON</h1>
<blockquote>
<p><a href="http://json.org/json-zh.html">JSON 介绍 - Douglas Crockford</a></p>
</blockquote>
<h2 id="heading-8">支持的数据类型</h2>
<ul>
<li>string
<blockquote>
<p><strong>(注意)只支持双引号，不支持单引号和无引号</strong></p>
</blockquote>
</li>
<li>number
<blockquote>
<p>支持科学计数法</p>
</blockquote>
</li>
<li>bool
<blockquote>
<p>true 和 false</p>
</blockquote>
</li>
<li>null
<blockquote>
<p>没有 undefined</p>
</blockquote>
</li>
<li>object</li>
<li>array
<blockquote>
<p>就这六种，注意跟 JS 的七种数据类型区别开来</p>
</blockquote>
</li>
</ul>
<blockquote>
<p>不支持函数，不支持变量(所以也不支持引用)</p>
</blockquote>
<h2 id="-json">加载 JSON</h2>
<ul>
<li>我们需要加载<code>5.json</code></li>
</ul>
<h2 id="heading-9">四个步骤</h2>
<ol>
<li>创建 HttpRequest 对象(全称是 XMLHttpRequest)</li>
<li>调用对象的 open 方法</li>
<li>监听对象的 onreadystatechange 事件
<blockquote>
<p>在事件处理函数里使用<code>JSON.parse</code></p>
</blockquote>
</li>
<li>调用对象的 send 方法(发送请求)</li>
</ol>
<p>HTML:</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html"><span style="color:#0f0;font-weight:bold">&lt;!DOCTYPE html&gt;</span>
&lt;<span style="font-weight:bold">html</span>&gt;
  &lt;<span style="font-weight:bold">head</span>&gt;
    &lt;<span style="font-weight:bold">title</span>&gt;ajax&lt;/<span style="font-weight:bold">title</span>&gt;
  &lt;/<span style="font-weight:bold">head</span>&gt;
  &lt;<span style="font-weight:bold">body</span>&gt;
    &lt;<span style="font-weight:bold">h1</span>&gt;AJAX Hello &lt;<span style="font-weight:bold">span</span> <span style="color:#007f7f">id</span>=<span style="color:#0ff;font-weight:bold">&#34;myName&#34;</span>&gt;&lt;/<span style="font-weight:bold">span</span>&gt;&lt;/<span style="font-weight:bold">h1</span>&gt;
    &lt;<span style="font-weight:bold">p</span>&gt;
      &lt;<span style="font-weight:bold">button</span> <span style="color:#007f7f">id</span>=<span style="color:#0ff;font-weight:bold">&#34;getJSON&#34;</span>&gt;request JSON&lt;/<span style="font-weight:bold">button</span>&gt;
    &lt;/<span style="font-weight:bold">p</span>&gt;
    &lt;<span style="font-weight:bold">script</span> <span style="color:#007f7f">src</span>=<span style="color:#0ff;font-weight:bold">&#34;/main.js&#34;</span>&gt;&lt;/<span style="font-weight:bold">script</span>&gt;
  &lt;/<span style="font-weight:bold">body</span>&gt;
&lt;/<span style="font-weight:bold">html</span>&gt;
</code></pre></div><p>JSON:</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="font-weight:bold">&#34;name&#34;</span>: <span style="color:#0ff;font-weight:bold">&#34;xiu&#34;</span>,
  <span style="font-weight:bold">&#34;age&#34;</span>: <span style="color:#ff0;font-weight:bold">24</span>,
  <span style="font-weight:bold">&#34;xxx&#34;</span>: <span style="color:#fff;font-weight:bold">null</span>
}
</code></pre></div><p>JavaScript:</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">getJSON.onclick = () =&gt; {
  <span style="color:#fff;font-weight:bold">const</span> request = <span style="color:#fff;font-weight:bold">new</span> XMLHttpRequest();
  request.open(<span style="color:#0ff;font-weight:bold">&#34;GET&#34;</span>, <span style="color:#0ff;font-weight:bold">&#34;/5.json&#34;</span>);
  request.onreadystatechange = () =&gt; {
    <span style="color:#fff;font-weight:bold">if</span> (request.readyState === <span style="color:#ff0;font-weight:bold">4</span> &amp;&amp; request.status === <span style="color:#ff0;font-weight:bold">200</span>) {
      <span style="color:#fff;font-weight:bold">const</span> object = JSON.parse(request.response);
      myName.textContent = object.name;
    }
  };
  request.send();
};
</code></pre></div><h2 id="windowjson">window.JSON</h2>
<h3 id="jsonparse"><code>JSON.parse</code></h3>
<ul>
<li>将符合<code>JSON</code>语法的字符串转换成<code>JS</code>对应类型的数据</li>
<li><code>JSON</code>字符串 →<code>JS</code>数据</li>
<li>由于<code>JSON</code>只有六种类型，所以转成的数据也只有 6 种</li>
<li>如果不符合<code>JSON</code>语法，则直接抛出一个<code>Error</code>对象</li>
<li>一般用<code>try catch</code>捕获错误</li>
</ul>
<h3 id="jsonstringify"><code>JSON.stringify</code></h3>
<ul>
<li>是<code>JSON.parse</code>的逆运算</li>
<li><code>JS</code>数据 → <code>JSON</code>字符串</li>
<li>由于<code>JS</code>的数据类型比<code>JSON</code>多，所以不一定能成功</li>
<li>如果失败，就抛出一个<code>Error</code>对象</li>
</ul>
<blockquote>
<p>全部 5 个挑战的<a href="https://github.com/ZhixiuKang/ajax-1">完整代码</a></p>
</blockquote>

    </div>

    <footer>
      


      <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "zhixiukang" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
      
      
    </footer>
  </article>

  
  
  
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.3/highlight.min.js"></script>
  <script>
    MathJax = {
      tex: {
        inlineMath: [
          ['$', '$'], ['\\(', '\\)']
        ],
        processEscapes: true,
        processEnvironments: true
      },
      options: {
        skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
      }
    };
  </script>
</section>

      </div>

      <footer class="footer">
  <section class="container">
    
     © 2020
    
    
  </section>
</footer>

    </main>

    

  </body>

</html>
